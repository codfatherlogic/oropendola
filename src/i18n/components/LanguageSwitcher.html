<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        .language-switcher {
            position: relative;
            display: inline-block;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        .language-switcher-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--vscode-button-background, #007acc);
            color: var(--vscode-button-foreground, #ffffff);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .language-switcher-button:hover {
            background: var(--vscode-button-hoverBackground, #005a9e);
        }

        .language-icon {
            width: 20px;
            height: 20px;
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 0.25rem;
            background: var(--vscode-dropdown-background, #3c3c3c);
            border: 1px solid var(--vscode-dropdown-border, #454545);
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            min-width: 200px;
            z-index: 1000;
            display: none;
        }

        .language-dropdown.open {
            display: block;
        }

        .language-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px solid var(--vscode-dropdown-border, #454545);
        }

        .language-option:last-child {
            border-bottom: none;
        }

        .language-option:hover {
            background: var(--vscode-list-hoverBackground, #2a2d2e);
        }

        .language-option.active {
            background: var(--vscode-list-activeSelectionBackground, #094771);
        }

        .language-flag {
            width: 24px;
            height: 18px;
            border-radius: 2px;
            background-size: cover;
            flex-shrink: 0;
        }

        .language-details {
            flex: 1;
        }

        .language-name {
            font-size: 14px;
            color: var(--vscode-dropdown-foreground, #cccccc);
            font-weight: 500;
        }

        .language-native-name {
            font-size: 12px;
            color: var(--vscode-descriptionForeground, #888888);
            margin-top: 2px;
        }

        .check-icon {
            width: 16px;
            height: 16px;
            color: var(--vscode-icon-foreground, #c5c5c5);
        }

        /* RTL support */
        .rtl .language-dropdown {
            left: auto;
            right: 0;
        }

        .rtl .language-option {
            flex-direction: row-reverse;
        }

        .rtl .language-details {
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="language-switcher" id="languageSwitcher">
        <button class="language-switcher-button" id="languageButton">
            <svg class="language-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M2 12h20M12 2a15.3 15.3 15.3 0 0 1 4 10 15.3 15.3 15.3 0 0 1-4 10 15.3 15.3 15.3 0 0 1-4-10 15.3 15.3 15.3 0 0 1 4-10z"/>
            </svg>
            <span id="currentLanguage">English</span>
            <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                <path d="M6 9L1 4h10z"/>
            </svg>
        </button>

        <div class="language-dropdown" id="languageDropdown">
            <!-- Dynamically populated -->
        </div>
    </div>

    <script>
        (function() {
            const languages = [
                { code: 'en', name: 'English', nativeName: 'English', rtl: false },
                { code: 'es', name: 'Spanish', nativeName: 'Español', rtl: false },
                { code: 'fr', name: 'French', nativeName: 'Français', rtl: false },
                { code: 'de', name: 'German', nativeName: 'Deutsch', rtl: false },
                { code: 'ar', name: 'Arabic', nativeName: 'العربية', rtl: true }
            ];

            let currentLanguage = 'en';

            const languageButton = document.getElementById('languageButton');
            const languageDropdown = document.getElementById('languageDropdown');
            const currentLanguageSpan = document.getElementById('currentLanguage');

            // Populate dropdown
            function populateDropdown() {
                languageDropdown.innerHTML = languages.map(lang => `
                    <div class="language-option ${lang.code === currentLanguage ? 'active' : ''}"
                         data-lang="${lang.code}">
                        <div class="language-details">
                            <div class="language-name">${lang.name}</div>
                            <div class="language-native-name">${lang.nativeName}</div>
                        </div>
                        ${lang.code === currentLanguage ? `
                            <svg class="check-icon" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M13.5 2L6 9.5 2.5 6 1 7.5 6 12.5 15 3.5z"/>
                            </svg>
                        ` : ''}
                    </div>
                `).join('');

                // Add click handlers
                document.querySelectorAll('.language-option').forEach(option => {
                    option.addEventListener('click', () => {
                        const langCode = option.getAttribute('data-lang');
                        selectLanguage(langCode);
                    });
                });
            }

            // Toggle dropdown
            languageButton.addEventListener('click', (e) => {
                e.stopPropagation();
                languageDropdown.classList.toggle('open');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', () => {
                languageDropdown.classList.remove('open');
            });

            // Select language
            function selectLanguage(langCode) {
                currentLanguage = langCode;
                const lang = languages.find(l => l.code === langCode);

                if (lang) {
                    currentLanguageSpan.textContent = lang.name;

                    // Update dropdown
                    populateDropdown();

                    // Close dropdown
                    languageDropdown.classList.remove('open');

                    // Post message to extension
                    if (window.vscode) {
                        window.vscode.postMessage({
                            type: 'languageChanged',
                            language: langCode
                        });
                    }

                    // Update RTL
                    if (lang.rtl) {
                        document.body.classList.add('rtl');
                        document.body.classList.remove('ltr');
                        document.documentElement.dir = 'rtl';
                    } else {
                        document.body.classList.add('ltr');
                        document.body.classList.remove('rtl');
                        document.documentElement.dir = 'ltr';
                    }
                }
            }

            // Initialize
            populateDropdown();

            // Listen for language updates from extension
            window.addEventListener('message', event => {
                const message = event.data;
                if (message.type === 'setLanguage') {
                    selectLanguage(message.language);
                }
            });

            // Expose API
            window.languageSwitcher = {
                setLanguage: selectLanguage,
                getCurrentLanguage: () => currentLanguage,
                getLanguages: () => languages
            };
        })();
    </script>
</body>
</html>
